<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>8x8 オセロゲーム</title>
  <link href="https://fonts.googleapis.com/css2?family=Darumadrop+One&display=swap" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 20px; }
    h1 { font-family: 'Darumadrop One', cursive; }
    table { border-collapse: collapse; margin: 0 auto; }
    td {
      width: 50px; height: 50px;
      border: 2px solid rgb(230, 36, 110);
      background-color: #ffc4e6; /* 囲碁の盤面風：薄茶色 */
      cursor: pointer;
      position: relative;
    
    .disc {
      width: 40px; height: 40px;
      border-radius: 50%;
      position: absolute;
      top: 5px; left: 5px;
      background-size: cover;
      background-position: center;
    }
    .black { background-image: url('gure.png'); }
    .white { background-image: url('sonnyul.png'); }
  </style>
</head>
<body>
  <h1>グレとソンニュルくんのオセロ</h1>
  <p id="turn">現在のターン: グレ</p>
  <table id="board"></table>

  <script>
    const board = document.getElementById('board');
    const size = 8;
    let turn = 'black';

    function createBoard() {
      for (let i = 0; i < size; i++) {
        const row = board.insertRow();
        for (let j = 0; j < size; j++) {
          const cell = row.insertCell();
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.addEventListener('click', handleClick);
        }
      }
      // 初期配置
      setDisc(3, 3, 'white');
      setDisc(4, 4, 'white');
      setDisc(3, 4, 'black');
      setDisc(4, 3, 'black');
    }

    function setDisc(row, col, color) {
      const cell = board.rows[row].cells[col];
      const existing = cell.querySelector('.disc');
      if (existing) cell.removeChild(existing);
      const disc = document.createElement('div');
      disc.classList.add('disc', color);
      cell.appendChild(disc);
    }

    function isValidMove(row, col, color) {
      const opponent = color === 'black' ? 'white' : 'black';
      if (board.rows[row].cells[col].querySelector('.disc')) return false;
      const directions = [
        [-1, 0], [1, 0], [0, -1], [0, 1],
        [-1, -1], [-1, 1], [1, -1], [1, 1]
      ];
      for (let [dx, dy] of directions) {
        let x = row + dx, y = col + dy;
        let foundOpponent = false;
        while (x >= 0 && y >= 0 && x < size && y < size) {
          const cell = board.rows[x].cells[y];
          const disc = cell.querySelector('.disc');
          if (!disc) break;
          if (disc.classList.contains(opponent)) {
            foundOpponent = true;
          } else if (disc.classList.contains(color) && foundOpponent) {
            return true;
          } else {
            break;
          }
          x += dx;
          y += dy;
        }
      }
      return false;
    }

    function flipDiscs(row, col, color) {
      const opponent = color === 'black' ? 'white' : 'black';
      const directions = [
        [-1, 0], [1, 0], [0, -1], [0, 1],
        [-1, -1], [-1, 1], [1, -1], [1, 1]
      ];
      for (let [dx, dy] of directions) {
        let x = row + dx, y = col + dy;
        let discsToFlip = [];
        while (x >= 0 && y >= 0 && x < size && y < size) {
          const cell = board.rows[x].cells[y];
          const disc = cell.querySelector('.disc');
          if (!disc) break;
          if (disc.classList.contains(opponent)) {
            discsToFlip.push(cell);
          } else if (disc.classList.contains(color)) {
            for (let flipCell of discsToFlip) {
              setDisc(flipCell.dataset.row, flipCell.dataset.col, color);
            }
            break;
          } else {
            break;
          }
          x += dx;
          y += dy;
        }
      }
    }

    function handleClick(e) {
      const row = parseInt(this.dataset.row);
      const col = parseInt(this.dataset.col);
      if (isValidMove(row, col, turn)) {
        setDisc(row, col, turn);
        flipDiscs(row, col, turn);
        turn = turn === 'black' ? 'white' : 'black';
        document.getElementById('turn').textContent = `現在のターン: ${turn === 'black' ? 'グレ' : 'ソンニュル'}`;
      }
    }

    createBoard();
  </script>
</body>
</html>